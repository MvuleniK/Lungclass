{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\n/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\nimport { backend_util, env, Multiply } from '@tensorflow/tfjs-core';\nimport * as binaryop_complex_gpu from \"../binaryop_complex_gpu\";\nimport { BinaryOpComplexProgram } from \"../binaryop_complex_gpu\";\nimport { BinaryOpProgram } from \"../binaryop_gpu\";\nimport { BinaryOpPackedProgram } from \"../binaryop_packed_gpu\";\nimport { multiplyImplCPU as cpuMultiply } from \"../kernel_utils/shared\";\nimport { complex } from \"./Complex\";\nvar MUL = 'return a * b;';\nexport function multiply(args) {\n  var inputs = args.inputs,\n      backend = args.backend;\n  var a = inputs.a,\n      b = inputs.b;\n  var dtype = backend_util.upcastType(a.dtype, b.dtype);\n\n  if (a.dtype === 'complex64') {\n    var aData = backend.texData.get(a.dataId);\n    var bData = backend.texData.get(b.dataId);\n    var realProgram = new BinaryOpComplexProgram(binaryop_complex_gpu.COMPLEX_MULTIPLY.REAL, a.shape, b.shape);\n    var imagProgram = new BinaryOpComplexProgram(binaryop_complex_gpu.COMPLEX_MULTIPLY.IMAG, a.shape, b.shape);\n    var _inputs = [{\n      dataId: aData.complexTensorInfos.real.dataId,\n      dtype: aData.complexTensorInfos.real.dtype,\n      shape: a.shape\n    }, {\n      dataId: aData.complexTensorInfos.imag.dataId,\n      dtype: aData.complexTensorInfos.imag.dtype,\n      shape: a.shape\n    }, {\n      dataId: bData.complexTensorInfos.real.dataId,\n      dtype: bData.complexTensorInfos.real.dtype,\n      shape: b.shape\n    }, {\n      dataId: bData.complexTensorInfos.imag.dataId,\n      dtype: bData.complexTensorInfos.imag.dtype,\n      shape: b.shape\n    }];\n    var realPart = backend.runWebGLProgram(realProgram, _inputs, 'float32');\n    var imagPart = backend.runWebGLProgram(imagProgram, _inputs, 'float32');\n    var complexOutput = complex({\n      inputs: {\n        real: realPart,\n        imag: imagPart\n      },\n      backend: backend\n    });\n    backend.disposeIntermediateTensorInfo(realPart);\n    backend.disposeIntermediateTensorInfo(imagPart);\n    return complexOutput;\n  }\n\n  if (backend.shouldExecuteOnCPU([a, b])) {\n    var _aData = backend.texData.get(a.dataId);\n\n    var _bData = backend.texData.get(b.dataId);\n\n    var _cpuMultiply = cpuMultiply(a.shape, b.shape, _aData.values, _bData.values, dtype),\n        _cpuMultiply2 = _slicedToArray(_cpuMultiply, 2),\n        outValues = _cpuMultiply2[0],\n        outShape = _cpuMultiply2[1];\n\n    var out = backend.makeTensorInfo(outShape, dtype);\n    var outData = backend.texData.get(out.dataId);\n    outData.values = outValues;\n    return out;\n  }\n\n  var program;\n\n  if (env().getBool('WEBGL_PACK_BINARY_OPERATIONS')) {\n    program = new BinaryOpPackedProgram(MUL, a.shape, b.shape);\n  } else {\n    program = new BinaryOpProgram(MUL, a.shape, b.shape);\n  }\n\n  return backend.runWebGLProgram(program, [a, b], dtype);\n}\nexport var multiplyConfig = {\n  kernelName: Multiply,\n  backendName: 'webgl',\n  kernelFunc: multiply\n};","map":{"version":3,"sources":["../../src/kernels/Multiply.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/**\n * @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\nimport { backend_util, env, Multiply } from '@tensorflow/tfjs-core';\nimport * as binaryop_complex_gpu from '../binaryop_complex_gpu';\nimport { BinaryOpComplexProgram } from '../binaryop_complex_gpu';\nimport { BinaryOpProgram } from '../binaryop_gpu';\nimport { BinaryOpPackedProgram } from '../binaryop_packed_gpu';\nimport { multiplyImplCPU as cpuMultiply } from '../kernel_utils/shared';\nimport { complex } from './Complex';\nconst MUL = 'return a * b;';\nexport function multiply(args) {\n    const { inputs, backend } = args;\n    const { a, b } = inputs;\n    const dtype = backend_util.upcastType(a.dtype, b.dtype);\n    if (a.dtype === 'complex64') {\n        const aData = backend.texData.get(a.dataId);\n        const bData = backend.texData.get(b.dataId);\n        const realProgram = new BinaryOpComplexProgram(binaryop_complex_gpu.COMPLEX_MULTIPLY.REAL, a.shape, b.shape);\n        const imagProgram = new BinaryOpComplexProgram(binaryop_complex_gpu.COMPLEX_MULTIPLY.IMAG, a.shape, b.shape);\n        const inputs = [\n            {\n                dataId: aData.complexTensorInfos.real.dataId,\n                dtype: aData.complexTensorInfos.real.dtype,\n                shape: a.shape\n            },\n            {\n                dataId: aData.complexTensorInfos.imag.dataId,\n                dtype: aData.complexTensorInfos.imag.dtype,\n                shape: a.shape\n            },\n            {\n                dataId: bData.complexTensorInfos.real.dataId,\n                dtype: bData.complexTensorInfos.real.dtype,\n                shape: b.shape\n            },\n            {\n                dataId: bData.complexTensorInfos.imag.dataId,\n                dtype: bData.complexTensorInfos.imag.dtype,\n                shape: b.shape\n            }\n        ];\n        const realPart = backend.runWebGLProgram(realProgram, inputs, 'float32');\n        const imagPart = backend.runWebGLProgram(imagProgram, inputs, 'float32');\n        const complexOutput = complex({ inputs: { real: realPart, imag: imagPart }, backend });\n        backend.disposeIntermediateTensorInfo(realPart);\n        backend.disposeIntermediateTensorInfo(imagPart);\n        // TODO(annxingyuan): CPU forwarding for complex inputs.\n        return complexOutput;\n    }\n    if (backend.shouldExecuteOnCPU([a, b])) {\n        const aData = backend.texData.get(a.dataId);\n        const bData = backend.texData.get(b.dataId);\n        const [outValues, outShape] = cpuMultiply(a.shape, b.shape, aData.values, bData.values, dtype);\n        const out = backend.makeTensorInfo(outShape, dtype);\n        const outData = backend.texData.get(out.dataId);\n        outData.values = outValues;\n        return out;\n    }\n    let program;\n    if (env().getBool('WEBGL_PACK_BINARY_OPERATIONS')) {\n        program = new BinaryOpPackedProgram(MUL, a.shape, b.shape);\n    }\n    else {\n        program = new BinaryOpProgram(MUL, a.shape, b.shape);\n    }\n    return backend.runWebGLProgram(program, [a, b], dtype);\n}\nexport const multiplyConfig = {\n    kernelName: Multiply,\n    backendName: 'webgl',\n    kernelFunc: multiply\n};\n//# sourceMappingURL=Multiply.js.map"]},"metadata":{},"sourceType":"module"}