{"ast":null,"code":"var JpegImage = function jpegImage() {\n  \"use strict\";\n\n  var dctZigZag = new Int32Array([0, 1, 8, 16, 9, 2, 3, 10, 17, 24, 32, 25, 18, 11, 4, 5, 12, 19, 26, 33, 40, 48, 41, 34, 27, 20, 13, 6, 7, 14, 21, 28, 35, 42, 49, 56, 57, 50, 43, 36, 29, 22, 15, 23, 30, 37, 44, 51, 58, 59, 52, 45, 38, 31, 39, 46, 53, 60, 61, 54, 47, 55, 62, 63]);\n  var dctCos1 = 4017;\n  var dctSin1 = 799;\n  var dctCos3 = 3406;\n  var dctSin3 = 2276;\n  var dctCos6 = 1567;\n  var dctSin6 = 3784;\n  var dctSqrt2 = 5793;\n  var dctSqrt1d2 = 2896;\n\n  function constructor() {}\n\n  function buildHuffmanTable(codeLengths, values) {\n    var k = 0,\n        code = [],\n        i,\n        j,\n        length = 16;\n\n    while (length > 0 && !codeLengths[length - 1]) {\n      length--;\n    }\n\n    code.push({\n      children: [],\n      index: 0\n    });\n    var p = code[0],\n        q;\n\n    for (i = 0; i < length; i++) {\n      for (j = 0; j < codeLengths[i]; j++) {\n        p = code.pop();\n        p.children[p.index] = values[k];\n\n        while (p.index > 0) {\n          if (code.length === 0) throw new Error('Could not recreate Huffman Table');\n          p = code.pop();\n        }\n\n        p.index++;\n        code.push(p);\n\n        while (code.length <= i) {\n          code.push(q = {\n            children: [],\n            index: 0\n          });\n          p.children[p.index] = q.children;\n          p = q;\n        }\n\n        k++;\n      }\n\n      if (i + 1 < length) {\n        code.push(q = {\n          children: [],\n          index: 0\n        });\n        p.children[p.index] = q.children;\n        p = q;\n      }\n    }\n\n    return code[0].children;\n  }\n\n  function decodeScan(data, offset, frame, components, resetInterval, spectralStart, spectralEnd, successivePrev, successive) {\n    var precision = frame.precision;\n    var samplesPerLine = frame.samplesPerLine;\n    var scanLines = frame.scanLines;\n    var mcusPerLine = frame.mcusPerLine;\n    var progressive = frame.progressive;\n    var maxH = frame.maxH,\n        maxV = frame.maxV;\n    var startOffset = offset,\n        bitsData = 0,\n        bitsCount = 0;\n\n    function readBit() {\n      if (bitsCount > 0) {\n        bitsCount--;\n        return bitsData >> bitsCount & 1;\n      }\n\n      bitsData = data[offset++];\n\n      if (bitsData == 0xFF) {\n        var nextByte = data[offset++];\n\n        if (nextByte) {\n          throw new Error(\"unexpected marker: \" + (bitsData << 8 | nextByte).toString(16));\n        }\n      }\n\n      bitsCount = 7;\n      return bitsData >>> 7;\n    }\n\n    function decodeHuffman(tree) {\n      var node = tree,\n          bit;\n\n      while ((bit = readBit()) !== null) {\n        node = node[bit];\n        if (typeof node === 'number') return node;\n        if (typeof node !== 'object') throw new Error(\"invalid huffman sequence\");\n      }\n\n      return null;\n    }\n\n    function receive(length) {\n      var n = 0;\n\n      while (length > 0) {\n        var bit = readBit();\n        if (bit === null) return;\n        n = n << 1 | bit;\n        length--;\n      }\n\n      return n;\n    }\n\n    function receiveAndExtend(length) {\n      var n = receive(length);\n      if (n >= 1 << length - 1) return n;\n      return n + (-1 << length) + 1;\n    }\n\n    function decodeBaseline(component, zz) {\n      var t = decodeHuffman(component.huffmanTableDC);\n      var diff = t === 0 ? 0 : receiveAndExtend(t);\n      zz[0] = component.pred += diff;\n      var k = 1;\n\n      while (k < 64) {\n        var rs = decodeHuffman(component.huffmanTableAC);\n        var s = rs & 15,\n            r = rs >> 4;\n\n        if (s === 0) {\n          if (r < 15) break;\n          k += 16;\n          continue;\n        }\n\n        k += r;\n        var z = dctZigZag[k];\n        zz[z] = receiveAndExtend(s);\n        k++;\n      }\n    }\n\n    function decodeDCFirst(component, zz) {\n      var t = decodeHuffman(component.huffmanTableDC);\n      var diff = t === 0 ? 0 : receiveAndExtend(t) << successive;\n      zz[0] = component.pred += diff;\n    }\n\n    function decodeDCSuccessive(component, zz) {\n      zz[0] |= readBit() << successive;\n    }\n\n    var eobrun = 0;\n\n    function decodeACFirst(component, zz) {\n      if (eobrun > 0) {\n        eobrun--;\n        return;\n      }\n\n      var k = spectralStart,\n          e = spectralEnd;\n\n      while (k <= e) {\n        var rs = decodeHuffman(component.huffmanTableAC);\n        var s = rs & 15,\n            r = rs >> 4;\n\n        if (s === 0) {\n          if (r < 15) {\n            eobrun = receive(r) + (1 << r) - 1;\n            break;\n          }\n\n          k += 16;\n          continue;\n        }\n\n        k += r;\n        var z = dctZigZag[k];\n        zz[z] = receiveAndExtend(s) * (1 << successive);\n        k++;\n      }\n    }\n\n    var successiveACState = 0,\n        successiveACNextValue;\n\n    function decodeACSuccessive(component, zz) {\n      var k = spectralStart,\n          e = spectralEnd,\n          r = 0;\n\n      while (k <= e) {\n        var z = dctZigZag[k];\n        var direction = zz[z] < 0 ? -1 : 1;\n\n        switch (successiveACState) {\n          case 0:\n            var rs = decodeHuffman(component.huffmanTableAC);\n            var s = rs & 15,\n                r = rs >> 4;\n\n            if (s === 0) {\n              if (r < 15) {\n                eobrun = receive(r) + (1 << r);\n                successiveACState = 4;\n              } else {\n                r = 16;\n                successiveACState = 1;\n              }\n            } else {\n              if (s !== 1) throw new Error(\"invalid ACn encoding\");\n              successiveACNextValue = receiveAndExtend(s);\n              successiveACState = r ? 2 : 3;\n            }\n\n            continue;\n\n          case 1:\n          case 2:\n            if (zz[z]) zz[z] += (readBit() << successive) * direction;else {\n              r--;\n              if (r === 0) successiveACState = successiveACState == 2 ? 3 : 0;\n            }\n            break;\n\n          case 3:\n            if (zz[z]) zz[z] += (readBit() << successive) * direction;else {\n              zz[z] = successiveACNextValue << successive;\n              successiveACState = 0;\n            }\n            break;\n\n          case 4:\n            if (zz[z]) zz[z] += (readBit() << successive) * direction;\n            break;\n        }\n\n        k++;\n      }\n\n      if (successiveACState === 4) {\n        eobrun--;\n        if (eobrun === 0) successiveACState = 0;\n      }\n    }\n\n    function decodeMcu(component, decode, mcu, row, col) {\n      var mcuRow = mcu / mcusPerLine | 0;\n      var mcuCol = mcu % mcusPerLine;\n      var blockRow = mcuRow * component.v + row;\n      var blockCol = mcuCol * component.h + col;\n      decode(component, component.blocks[blockRow][blockCol]);\n    }\n\n    function decodeBlock(component, decode, mcu) {\n      var blockRow = mcu / component.blocksPerLine | 0;\n      var blockCol = mcu % component.blocksPerLine;\n      decode(component, component.blocks[blockRow][blockCol]);\n    }\n\n    var componentsLength = components.length;\n    var component, i, j, k, n;\n    var decodeFn;\n\n    if (progressive) {\n      if (spectralStart === 0) decodeFn = successivePrev === 0 ? decodeDCFirst : decodeDCSuccessive;else decodeFn = successivePrev === 0 ? decodeACFirst : decodeACSuccessive;\n    } else {\n      decodeFn = decodeBaseline;\n    }\n\n    var mcu = 0,\n        marker;\n    var mcuExpected;\n\n    if (componentsLength == 1) {\n      mcuExpected = components[0].blocksPerLine * components[0].blocksPerColumn;\n    } else {\n      mcuExpected = mcusPerLine * frame.mcusPerColumn;\n    }\n\n    if (!resetInterval) resetInterval = mcuExpected;\n    var h, v;\n\n    while (mcu < mcuExpected) {\n      for (i = 0; i < componentsLength; i++) {\n        components[i].pred = 0;\n      }\n\n      eobrun = 0;\n\n      if (componentsLength == 1) {\n        component = components[0];\n\n        for (n = 0; n < resetInterval; n++) {\n          decodeBlock(component, decodeFn, mcu);\n          mcu++;\n        }\n      } else {\n        for (n = 0; n < resetInterval; n++) {\n          for (i = 0; i < componentsLength; i++) {\n            component = components[i];\n            h = component.h;\n            v = component.v;\n\n            for (j = 0; j < v; j++) {\n              for (k = 0; k < h; k++) {\n                decodeMcu(component, decodeFn, mcu, j, k);\n              }\n            }\n          }\n\n          mcu++;\n          if (mcu === mcuExpected) break;\n        }\n      }\n\n      bitsCount = 0;\n      marker = data[offset] << 8 | data[offset + 1];\n\n      if (marker < 0xFF00) {\n        throw new Error(\"marker was not found\");\n      }\n\n      if (marker >= 0xFFD0 && marker <= 0xFFD7) {\n        offset += 2;\n      } else break;\n    }\n\n    return offset - startOffset;\n  }\n\n  function buildComponentData(frame, component) {\n    var lines = [];\n    var blocksPerLine = component.blocksPerLine;\n    var blocksPerColumn = component.blocksPerColumn;\n    var samplesPerLine = blocksPerLine << 3;\n    var R = new Int32Array(64),\n        r = new Uint8Array(64);\n\n    function quantizeAndInverse(zz, dataOut, dataIn) {\n      var qt = component.quantizationTable;\n      var v0, v1, v2, v3, v4, v5, v6, v7, t;\n      var p = dataIn;\n      var i;\n\n      for (i = 0; i < 64; i++) {\n        p[i] = zz[i] * qt[i];\n      }\n\n      for (i = 0; i < 8; ++i) {\n        var row = 8 * i;\n\n        if (p[1 + row] == 0 && p[2 + row] == 0 && p[3 + row] == 0 && p[4 + row] == 0 && p[5 + row] == 0 && p[6 + row] == 0 && p[7 + row] == 0) {\n          t = dctSqrt2 * p[0 + row] + 512 >> 10;\n          p[0 + row] = t;\n          p[1 + row] = t;\n          p[2 + row] = t;\n          p[3 + row] = t;\n          p[4 + row] = t;\n          p[5 + row] = t;\n          p[6 + row] = t;\n          p[7 + row] = t;\n          continue;\n        }\n\n        v0 = dctSqrt2 * p[0 + row] + 128 >> 8;\n        v1 = dctSqrt2 * p[4 + row] + 128 >> 8;\n        v2 = p[2 + row];\n        v3 = p[6 + row];\n        v4 = dctSqrt1d2 * (p[1 + row] - p[7 + row]) + 128 >> 8;\n        v7 = dctSqrt1d2 * (p[1 + row] + p[7 + row]) + 128 >> 8;\n        v5 = p[3 + row] << 4;\n        v6 = p[5 + row] << 4;\n        t = v0 - v1 + 1 >> 1;\n        v0 = v0 + v1 + 1 >> 1;\n        v1 = t;\n        t = v2 * dctSin6 + v3 * dctCos6 + 128 >> 8;\n        v2 = v2 * dctCos6 - v3 * dctSin6 + 128 >> 8;\n        v3 = t;\n        t = v4 - v6 + 1 >> 1;\n        v4 = v4 + v6 + 1 >> 1;\n        v6 = t;\n        t = v7 + v5 + 1 >> 1;\n        v5 = v7 - v5 + 1 >> 1;\n        v7 = t;\n        t = v0 - v3 + 1 >> 1;\n        v0 = v0 + v3 + 1 >> 1;\n        v3 = t;\n        t = v1 - v2 + 1 >> 1;\n        v1 = v1 + v2 + 1 >> 1;\n        v2 = t;\n        t = v4 * dctSin3 + v7 * dctCos3 + 2048 >> 12;\n        v4 = v4 * dctCos3 - v7 * dctSin3 + 2048 >> 12;\n        v7 = t;\n        t = v5 * dctSin1 + v6 * dctCos1 + 2048 >> 12;\n        v5 = v5 * dctCos1 - v6 * dctSin1 + 2048 >> 12;\n        v6 = t;\n        p[0 + row] = v0 + v7;\n        p[7 + row] = v0 - v7;\n        p[1 + row] = v1 + v6;\n        p[6 + row] = v1 - v6;\n        p[2 + row] = v2 + v5;\n        p[5 + row] = v2 - v5;\n        p[3 + row] = v3 + v4;\n        p[4 + row] = v3 - v4;\n      }\n\n      for (i = 0; i < 8; ++i) {\n        var col = i;\n\n        if (p[1 * 8 + col] == 0 && p[2 * 8 + col] == 0 && p[3 * 8 + col] == 0 && p[4 * 8 + col] == 0 && p[5 * 8 + col] == 0 && p[6 * 8 + col] == 0 && p[7 * 8 + col] == 0) {\n          t = dctSqrt2 * dataIn[i + 0] + 8192 >> 14;\n          p[0 * 8 + col] = t;\n          p[1 * 8 + col] = t;\n          p[2 * 8 + col] = t;\n          p[3 * 8 + col] = t;\n          p[4 * 8 + col] = t;\n          p[5 * 8 + col] = t;\n          p[6 * 8 + col] = t;\n          p[7 * 8 + col] = t;\n          continue;\n        }\n\n        v0 = dctSqrt2 * p[0 * 8 + col] + 2048 >> 12;\n        v1 = dctSqrt2 * p[4 * 8 + col] + 2048 >> 12;\n        v2 = p[2 * 8 + col];\n        v3 = p[6 * 8 + col];\n        v4 = dctSqrt1d2 * (p[1 * 8 + col] - p[7 * 8 + col]) + 2048 >> 12;\n        v7 = dctSqrt1d2 * (p[1 * 8 + col] + p[7 * 8 + col]) + 2048 >> 12;\n        v5 = p[3 * 8 + col];\n        v6 = p[5 * 8 + col];\n        t = v0 - v1 + 1 >> 1;\n        v0 = v0 + v1 + 1 >> 1;\n        v1 = t;\n        t = v2 * dctSin6 + v3 * dctCos6 + 2048 >> 12;\n        v2 = v2 * dctCos6 - v3 * dctSin6 + 2048 >> 12;\n        v3 = t;\n        t = v4 - v6 + 1 >> 1;\n        v4 = v4 + v6 + 1 >> 1;\n        v6 = t;\n        t = v7 + v5 + 1 >> 1;\n        v5 = v7 - v5 + 1 >> 1;\n        v7 = t;\n        t = v0 - v3 + 1 >> 1;\n        v0 = v0 + v3 + 1 >> 1;\n        v3 = t;\n        t = v1 - v2 + 1 >> 1;\n        v1 = v1 + v2 + 1 >> 1;\n        v2 = t;\n        t = v4 * dctSin3 + v7 * dctCos3 + 2048 >> 12;\n        v4 = v4 * dctCos3 - v7 * dctSin3 + 2048 >> 12;\n        v7 = t;\n        t = v5 * dctSin1 + v6 * dctCos1 + 2048 >> 12;\n        v5 = v5 * dctCos1 - v6 * dctSin1 + 2048 >> 12;\n        v6 = t;\n        p[0 * 8 + col] = v0 + v7;\n        p[7 * 8 + col] = v0 - v7;\n        p[1 * 8 + col] = v1 + v6;\n        p[6 * 8 + col] = v1 - v6;\n        p[2 * 8 + col] = v2 + v5;\n        p[5 * 8 + col] = v2 - v5;\n        p[3 * 8 + col] = v3 + v4;\n        p[4 * 8 + col] = v3 - v4;\n      }\n\n      for (i = 0; i < 64; ++i) {\n        var sample = 128 + (p[i] + 8 >> 4);\n        dataOut[i] = sample < 0 ? 0 : sample > 0xFF ? 0xFF : sample;\n      }\n    }\n\n    var i, j;\n\n    for (var blockRow = 0; blockRow < blocksPerColumn; blockRow++) {\n      var scanLine = blockRow << 3;\n\n      for (i = 0; i < 8; i++) {\n        lines.push(new Uint8Array(samplesPerLine));\n      }\n\n      for (var blockCol = 0; blockCol < blocksPerLine; blockCol++) {\n        quantizeAndInverse(component.blocks[blockRow][blockCol], r, R);\n        var offset = 0,\n            sample = blockCol << 3;\n\n        for (j = 0; j < 8; j++) {\n          var line = lines[scanLine + j];\n\n          for (i = 0; i < 8; i++) {\n            line[sample + i] = r[offset++];\n          }\n        }\n      }\n    }\n\n    return lines;\n  }\n\n  function clampTo8bit(a) {\n    return a < 0 ? 0 : a > 255 ? 255 : a;\n  }\n\n  constructor.prototype = {\n    load: function load(path) {\n      var xhr = new XMLHttpRequest();\n      xhr.open(\"GET\", path, true);\n      xhr.responseType = \"arraybuffer\";\n\n      xhr.onload = function () {\n        var data = new Uint8Array(xhr.response || xhr.mozResponseArrayBuffer);\n        this.parse(data);\n        if (this.onload) this.onload();\n      }.bind(this);\n\n      xhr.send(null);\n    },\n    parse: function parse(data) {\n      var offset = 0,\n          length = data.length;\n\n      function readUint16() {\n        var value = data[offset] << 8 | data[offset + 1];\n        offset += 2;\n        return value;\n      }\n\n      function readDataBlock() {\n        var length = readUint16();\n        var array = data.subarray(offset, offset + length - 2);\n        offset += array.length;\n        return array;\n      }\n\n      function prepareComponents(frame) {\n        var maxH = 0,\n            maxV = 0;\n        var component, componentId;\n\n        for (componentId in frame.components) {\n          if (frame.components.hasOwnProperty(componentId)) {\n            component = frame.components[componentId];\n            if (maxH < component.h) maxH = component.h;\n            if (maxV < component.v) maxV = component.v;\n          }\n        }\n\n        var mcusPerLine = Math.ceil(frame.samplesPerLine / 8 / maxH);\n        var mcusPerColumn = Math.ceil(frame.scanLines / 8 / maxV);\n\n        for (componentId in frame.components) {\n          if (frame.components.hasOwnProperty(componentId)) {\n            component = frame.components[componentId];\n            var blocksPerLine = Math.ceil(Math.ceil(frame.samplesPerLine / 8) * component.h / maxH);\n            var blocksPerColumn = Math.ceil(Math.ceil(frame.scanLines / 8) * component.v / maxV);\n            var blocksPerLineForMcu = mcusPerLine * component.h;\n            var blocksPerColumnForMcu = mcusPerColumn * component.v;\n            var blocks = [];\n\n            for (var i = 0; i < blocksPerColumnForMcu; i++) {\n              var row = [];\n\n              for (var j = 0; j < blocksPerLineForMcu; j++) {\n                row.push(new Int32Array(64));\n              }\n\n              blocks.push(row);\n            }\n\n            component.blocksPerLine = blocksPerLine;\n            component.blocksPerColumn = blocksPerColumn;\n            component.blocks = blocks;\n          }\n        }\n\n        frame.maxH = maxH;\n        frame.maxV = maxV;\n        frame.mcusPerLine = mcusPerLine;\n        frame.mcusPerColumn = mcusPerColumn;\n      }\n\n      var jfif = null;\n      var adobe = null;\n      var pixels = null;\n      var frame, resetInterval;\n      var quantizationTables = [],\n          frames = [];\n      var huffmanTablesAC = [],\n          huffmanTablesDC = [];\n      var fileMarker = readUint16();\n\n      if (fileMarker != 0xFFD8) {\n        throw new Error(\"SOI not found\");\n      }\n\n      fileMarker = readUint16();\n\n      while (fileMarker != 0xFFD9) {\n        var i, j, l;\n\n        switch (fileMarker) {\n          case 0xFF00:\n            break;\n\n          case 0xFFE0:\n          case 0xFFE1:\n          case 0xFFE2:\n          case 0xFFE3:\n          case 0xFFE4:\n          case 0xFFE5:\n          case 0xFFE6:\n          case 0xFFE7:\n          case 0xFFE8:\n          case 0xFFE9:\n          case 0xFFEA:\n          case 0xFFEB:\n          case 0xFFEC:\n          case 0xFFED:\n          case 0xFFEE:\n          case 0xFFEF:\n          case 0xFFFE:\n            var appData = readDataBlock();\n\n            if (fileMarker === 0xFFE0) {\n              if (appData[0] === 0x4A && appData[1] === 0x46 && appData[2] === 0x49 && appData[3] === 0x46 && appData[4] === 0) {\n                jfif = {\n                  version: {\n                    major: appData[5],\n                    minor: appData[6]\n                  },\n                  densityUnits: appData[7],\n                  xDensity: appData[8] << 8 | appData[9],\n                  yDensity: appData[10] << 8 | appData[11],\n                  thumbWidth: appData[12],\n                  thumbHeight: appData[13],\n                  thumbData: appData.subarray(14, 14 + 3 * appData[12] * appData[13])\n                };\n              }\n            }\n\n            if (fileMarker === 0xFFEE) {\n              if (appData[0] === 0x41 && appData[1] === 0x64 && appData[2] === 0x6F && appData[3] === 0x62 && appData[4] === 0x65 && appData[5] === 0) {\n                adobe = {\n                  version: appData[6],\n                  flags0: appData[7] << 8 | appData[8],\n                  flags1: appData[9] << 8 | appData[10],\n                  transformCode: appData[11]\n                };\n              }\n            }\n\n            break;\n\n          case 0xFFDB:\n            var quantizationTablesLength = readUint16();\n            var quantizationTablesEnd = quantizationTablesLength + offset - 2;\n\n            while (offset < quantizationTablesEnd) {\n              var quantizationTableSpec = data[offset++];\n              var tableData = new Int32Array(64);\n\n              if (quantizationTableSpec >> 4 === 0) {\n                for (j = 0; j < 64; j++) {\n                  var z = dctZigZag[j];\n                  tableData[z] = data[offset++];\n                }\n              } else if (quantizationTableSpec >> 4 === 1) {\n                for (j = 0; j < 64; j++) {\n                  var z = dctZigZag[j];\n                  tableData[z] = readUint16();\n                }\n              } else throw new Error(\"DQT: invalid table spec\");\n\n              quantizationTables[quantizationTableSpec & 15] = tableData;\n            }\n\n            break;\n\n          case 0xFFC0:\n          case 0xFFC1:\n          case 0xFFC2:\n            readUint16();\n            frame = {};\n            frame.extended = fileMarker === 0xFFC1;\n            frame.progressive = fileMarker === 0xFFC2;\n            frame.precision = data[offset++];\n            frame.scanLines = readUint16();\n            frame.samplesPerLine = readUint16();\n            frame.components = {};\n            frame.componentsOrder = [];\n            var componentsCount = data[offset++],\n                componentId;\n            var maxH = 0,\n                maxV = 0;\n\n            for (i = 0; i < componentsCount; i++) {\n              componentId = data[offset];\n              var h = data[offset + 1] >> 4;\n              var v = data[offset + 1] & 15;\n              var qId = data[offset + 2];\n              frame.componentsOrder.push(componentId);\n              frame.components[componentId] = {\n                h: h,\n                v: v,\n                quantizationIdx: qId\n              };\n              offset += 3;\n            }\n\n            prepareComponents(frame);\n            frames.push(frame);\n            break;\n\n          case 0xFFC4:\n            var huffmanLength = readUint16();\n\n            for (i = 2; i < huffmanLength;) {\n              var huffmanTableSpec = data[offset++];\n              var codeLengths = new Uint8Array(16);\n              var codeLengthSum = 0;\n\n              for (j = 0; j < 16; j++, offset++) {\n                codeLengthSum += codeLengths[j] = data[offset];\n              }\n\n              var huffmanValues = new Uint8Array(codeLengthSum);\n\n              for (j = 0; j < codeLengthSum; j++, offset++) {\n                huffmanValues[j] = data[offset];\n              }\n\n              i += 17 + codeLengthSum;\n              (huffmanTableSpec >> 4 === 0 ? huffmanTablesDC : huffmanTablesAC)[huffmanTableSpec & 15] = buildHuffmanTable(codeLengths, huffmanValues);\n            }\n\n            break;\n\n          case 0xFFDD:\n            readUint16();\n            resetInterval = readUint16();\n            break;\n\n          case 0xFFDA:\n            var scanLength = readUint16();\n            var selectorsCount = data[offset++];\n            var components = [],\n                component;\n\n            for (i = 0; i < selectorsCount; i++) {\n              component = frame.components[data[offset++]];\n              var tableSpec = data[offset++];\n              component.huffmanTableDC = huffmanTablesDC[tableSpec >> 4];\n              component.huffmanTableAC = huffmanTablesAC[tableSpec & 15];\n              components.push(component);\n            }\n\n            var spectralStart = data[offset++];\n            var spectralEnd = data[offset++];\n            var successiveApproximation = data[offset++];\n            var processed = decodeScan(data, offset, frame, components, resetInterval, spectralStart, spectralEnd, successiveApproximation >> 4, successiveApproximation & 15);\n            offset += processed;\n            break;\n\n          case 0xFFFF:\n            if (data[offset] !== 0xFF) {\n              offset--;\n            }\n\n            break;\n\n          default:\n            if (data[offset - 3] == 0xFF && data[offset - 2] >= 0xC0 && data[offset - 2] <= 0xFE) {\n              offset -= 3;\n              break;\n            }\n\n            throw new Error(\"unknown JPEG marker \" + fileMarker.toString(16));\n        }\n\n        fileMarker = readUint16();\n      }\n\n      if (frames.length != 1) throw new Error(\"only single frame JPEGs supported\");\n\n      for (var i = 0; i < frames.length; i++) {\n        var cp = frames[i].components;\n\n        for (var j in cp) {\n          cp[j].quantizationTable = quantizationTables[cp[j].quantizationIdx];\n          delete cp[j].quantizationIdx;\n        }\n      }\n\n      this.width = frame.samplesPerLine;\n      this.height = frame.scanLines;\n      this.jfif = jfif;\n      this.adobe = adobe;\n      this.components = [];\n\n      for (var i = 0; i < frame.componentsOrder.length; i++) {\n        var component = frame.components[frame.componentsOrder[i]];\n        this.components.push({\n          lines: buildComponentData(frame, component),\n          scaleX: component.h / frame.maxH,\n          scaleY: component.v / frame.maxV\n        });\n      }\n    },\n    getData: function getData(width, height) {\n      var scaleX = this.width / width,\n          scaleY = this.height / height;\n      var component1, component2, component3, component4;\n      var component1Line, component2Line, component3Line, component4Line;\n      var x, y;\n      var offset = 0;\n      var Y, Cb, Cr, K, C, M, Ye, R, G, B;\n      var colorTransform;\n      var dataLength = width * height * this.components.length;\n      var data = new Uint8Array(dataLength);\n\n      switch (this.components.length) {\n        case 1:\n          component1 = this.components[0];\n\n          for (y = 0; y < height; y++) {\n            component1Line = component1.lines[0 | y * component1.scaleY * scaleY];\n\n            for (x = 0; x < width; x++) {\n              Y = component1Line[0 | x * component1.scaleX * scaleX];\n              data[offset++] = Y;\n            }\n          }\n\n          break;\n\n        case 2:\n          component1 = this.components[0];\n          component2 = this.components[1];\n\n          for (y = 0; y < height; y++) {\n            component1Line = component1.lines[0 | y * component1.scaleY * scaleY];\n            component2Line = component2.lines[0 | y * component2.scaleY * scaleY];\n\n            for (x = 0; x < width; x++) {\n              Y = component1Line[0 | x * component1.scaleX * scaleX];\n              data[offset++] = Y;\n              Y = component2Line[0 | x * component2.scaleX * scaleX];\n              data[offset++] = Y;\n            }\n          }\n\n          break;\n\n        case 3:\n          colorTransform = true;\n          if (this.adobe && this.adobe.transformCode) colorTransform = true;else if (typeof this.colorTransform !== 'undefined') colorTransform = !!this.colorTransform;\n          component1 = this.components[0];\n          component2 = this.components[1];\n          component3 = this.components[2];\n\n          for (y = 0; y < height; y++) {\n            component1Line = component1.lines[0 | y * component1.scaleY * scaleY];\n            component2Line = component2.lines[0 | y * component2.scaleY * scaleY];\n            component3Line = component3.lines[0 | y * component3.scaleY * scaleY];\n\n            for (x = 0; x < width; x++) {\n              if (!colorTransform) {\n                R = component1Line[0 | x * component1.scaleX * scaleX];\n                G = component2Line[0 | x * component2.scaleX * scaleX];\n                B = component3Line[0 | x * component3.scaleX * scaleX];\n              } else {\n                Y = component1Line[0 | x * component1.scaleX * scaleX];\n                Cb = component2Line[0 | x * component2.scaleX * scaleX];\n                Cr = component3Line[0 | x * component3.scaleX * scaleX];\n                R = clampTo8bit(Y + 1.402 * (Cr - 128));\n                G = clampTo8bit(Y - 0.3441363 * (Cb - 128) - 0.71413636 * (Cr - 128));\n                B = clampTo8bit(Y + 1.772 * (Cb - 128));\n              }\n\n              data[offset++] = R;\n              data[offset++] = G;\n              data[offset++] = B;\n            }\n          }\n\n          break;\n\n        case 4:\n          if (!this.adobe) throw new Error('Unsupported color mode (4 components)');\n          colorTransform = false;\n          if (this.adobe && this.adobe.transformCode) colorTransform = true;else if (typeof this.colorTransform !== 'undefined') colorTransform = !!this.colorTransform;\n          component1 = this.components[0];\n          component2 = this.components[1];\n          component3 = this.components[2];\n          component4 = this.components[3];\n\n          for (y = 0; y < height; y++) {\n            component1Line = component1.lines[0 | y * component1.scaleY * scaleY];\n            component2Line = component2.lines[0 | y * component2.scaleY * scaleY];\n            component3Line = component3.lines[0 | y * component3.scaleY * scaleY];\n            component4Line = component4.lines[0 | y * component4.scaleY * scaleY];\n\n            for (x = 0; x < width; x++) {\n              if (!colorTransform) {\n                C = component1Line[0 | x * component1.scaleX * scaleX];\n                M = component2Line[0 | x * component2.scaleX * scaleX];\n                Ye = component3Line[0 | x * component3.scaleX * scaleX];\n                K = component4Line[0 | x * component4.scaleX * scaleX];\n              } else {\n                Y = component1Line[0 | x * component1.scaleX * scaleX];\n                Cb = component2Line[0 | x * component2.scaleX * scaleX];\n                Cr = component3Line[0 | x * component3.scaleX * scaleX];\n                K = component4Line[0 | x * component4.scaleX * scaleX];\n                C = 255 - clampTo8bit(Y + 1.402 * (Cr - 128));\n                M = 255 - clampTo8bit(Y - 0.3441363 * (Cb - 128) - 0.71413636 * (Cr - 128));\n                Ye = 255 - clampTo8bit(Y + 1.772 * (Cb - 128));\n              }\n\n              data[offset++] = 255 - C;\n              data[offset++] = 255 - M;\n              data[offset++] = 255 - Ye;\n              data[offset++] = 255 - K;\n            }\n          }\n\n          break;\n\n        default:\n          throw new Error('Unsupported color mode');\n      }\n\n      return data;\n    },\n    copyToImageData: function copyToImageData(imageData, formatAsRGBA) {\n      var width = imageData.width,\n          height = imageData.height;\n      var imageDataArray = imageData.data;\n      var data = this.getData(width, height);\n      var i = 0,\n          j = 0,\n          x,\n          y;\n      var Y, K, C, M, R, G, B;\n\n      switch (this.components.length) {\n        case 1:\n          for (y = 0; y < height; y++) {\n            for (x = 0; x < width; x++) {\n              Y = data[i++];\n              imageDataArray[j++] = Y;\n              imageDataArray[j++] = Y;\n              imageDataArray[j++] = Y;\n\n              if (formatAsRGBA) {\n                imageDataArray[j++] = 255;\n              }\n            }\n          }\n\n          break;\n\n        case 3:\n          for (y = 0; y < height; y++) {\n            for (x = 0; x < width; x++) {\n              R = data[i++];\n              G = data[i++];\n              B = data[i++];\n              imageDataArray[j++] = R;\n              imageDataArray[j++] = G;\n              imageDataArray[j++] = B;\n\n              if (formatAsRGBA) {\n                imageDataArray[j++] = 255;\n              }\n            }\n          }\n\n          break;\n\n        case 4:\n          for (y = 0; y < height; y++) {\n            for (x = 0; x < width; x++) {\n              C = data[i++];\n              M = data[i++];\n              Y = data[i++];\n              K = data[i++];\n              R = 255 - clampTo8bit(C * (1 - K / 255) + K);\n              G = 255 - clampTo8bit(M * (1 - K / 255) + K);\n              B = 255 - clampTo8bit(Y * (1 - K / 255) + K);\n              imageDataArray[j++] = R;\n              imageDataArray[j++] = G;\n              imageDataArray[j++] = B;\n\n              if (formatAsRGBA) {\n                imageDataArray[j++] = 255;\n              }\n            }\n          }\n\n          break;\n\n        default:\n          throw new Error('Unsupported color mode');\n      }\n    }\n  };\n  return constructor;\n}();\n\nmodule.exports = decode;\n\nfunction decode(jpegData, opts) {\n  var defaultOpts = {\n    useTArray: false,\n    colorTransform: undefined,\n    formatAsRGBA: true\n  };\n\n  if (opts) {\n    if (typeof opts === 'object') {\n      opts = {\n        useTArray: typeof opts.useTArray === 'undefined' ? defaultOpts.useTArray : opts.useTArray,\n        colorTransform: typeof opts.colorTransform === 'undefined' ? defaultOpts.colorTransform : opts.colorTransform,\n        formatAsRGBA: typeof opts.formatAsRGBA === 'undefined' ? defaultOpts.formatAsRGBA : opts.formatAsRGBA\n      };\n    } else {\n      opts = defaultOpts;\n      opts.useTArray = true;\n    }\n  } else {\n    opts = defaultOpts;\n  }\n\n  var arr = new Uint8Array(jpegData);\n  var decoder = new JpegImage();\n  decoder.parse(arr);\n  decoder.colorTransform = opts.colorTransform;\n  var channels = opts.formatAsRGBA ? 4 : 3;\n  var bytesNeeded = decoder.width * decoder.height * channels;\n\n  try {\n    var image = {\n      width: decoder.width,\n      height: decoder.height,\n      data: opts.useTArray ? new Uint8Array(bytesNeeded) : new Buffer(bytesNeeded)\n    };\n  } catch (err) {\n    if (err instanceof RangeError) {\n      throw new Error(\"Could not allocate enough memory for the image. \" + \"Required: \" + bytesNeeded);\n    } else {\n      throw err;\n    }\n  }\n\n  decoder.copyToImageData(image, opts.formatAsRGBA);\n  return image;\n}","map":{"version":3,"names":["JpegImage","jpegImage","dctZigZag","Int32Array","dctCos1","dctSin1","dctCos3","dctSin3","dctCos6","dctSin6","dctSqrt2","dctSqrt1d2","constructor","buildHuffmanTable","codeLengths","values","k","code","i","j","length","push","children","index","p","q","pop","Error","decodeScan","data","offset","frame","components","resetInterval","spectralStart","spectralEnd","successivePrev","successive","precision","samplesPerLine","scanLines","mcusPerLine","progressive","maxH","maxV","startOffset","bitsData","bitsCount","readBit","nextByte","toString","decodeHuffman","tree","node","bit","receive","n","receiveAndExtend","decodeBaseline","component","zz","t","huffmanTableDC","diff","pred","rs","huffmanTableAC","s","r","z","decodeDCFirst","decodeDCSuccessive","eobrun","decodeACFirst","e","successiveACState","successiveACNextValue","decodeACSuccessive","direction","decodeMcu","decode","mcu","row","col","mcuRow","mcuCol","blockRow","v","blockCol","h","blocks","decodeBlock","blocksPerLine","componentsLength","decodeFn","marker","mcuExpected","blocksPerColumn","mcusPerColumn","buildComponentData","lines","R","Uint8Array","quantizeAndInverse","dataOut","dataIn","qt","quantizationTable","v0","v1","v2","v3","v4","v5","v6","v7","sample","scanLine","line","clampTo8bit","a","prototype","load","path","xhr","XMLHttpRequest","open","responseType","onload","response","mozResponseArrayBuffer","parse","bind","send","readUint16","value","readDataBlock","array","subarray","prepareComponents","componentId","hasOwnProperty","Math","ceil","blocksPerLineForMcu","blocksPerColumnForMcu","jfif","adobe","pixels","quantizationTables","frames","huffmanTablesAC","huffmanTablesDC","fileMarker","l","appData","version","major","minor","densityUnits","xDensity","yDensity","thumbWidth","thumbHeight","thumbData","flags0","flags1","transformCode","quantizationTablesLength","quantizationTablesEnd","quantizationTableSpec","tableData","extended","componentsOrder","componentsCount","qId","quantizationIdx","huffmanLength","huffmanTableSpec","codeLengthSum","huffmanValues","scanLength","selectorsCount","tableSpec","successiveApproximation","processed","cp","width","height","scaleX","scaleY","getData","component1","component2","component3","component4","component1Line","component2Line","component3Line","component4Line","x","y","Y","Cb","Cr","K","C","M","Ye","G","B","colorTransform","dataLength","copyToImageData","imageData","formatAsRGBA","imageDataArray","module","exports","jpegData","opts","defaultOpts","useTArray","undefined","arr","decoder","channels","bytesNeeded","image","Buffer","err","RangeError"],"sources":["C:/Users/mlab/Aireact/Lungclass/node_modules/@tensorflow/tfjs-react-native/node_modules/jpeg-js/lib/decoder.js"],"sourcesContent":["/* -*- tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- /\n/* vim: set shiftwidth=2 tabstop=2 autoindent cindent expandtab: */\n/*\n   Copyright 2011 notmasteryet\n\n   Licensed under the Apache License, Version 2.0 (the \"License\");\n   you may not use this file except in compliance with the License.\n   You may obtain a copy of the License at\n\n       http://www.apache.org/licenses/LICENSE-2.0\n\n   Unless required by applicable law or agreed to in writing, software\n   distributed under the License is distributed on an \"AS IS\" BASIS,\n   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   See the License for the specific language governing permissions and\n   limitations under the License.\n*/\n\n// - The JPEG specification can be found in the ITU CCITT Recommendation T.81\n//   (www.w3.org/Graphics/JPEG/itu-t81.pdf)\n// - The JFIF specification can be found in the JPEG File Interchange Format\n//   (www.w3.org/Graphics/JPEG/jfif3.pdf)\n// - The Adobe Application-Specific JPEG markers in the Supporting the DCT Filters\n//   in PostScript Level 2, Technical Note #5116\n//   (partners.adobe.com/public/developer/en/ps/sdk/5116.DCT_Filter.pdf)\n\nvar JpegImage = (function jpegImage() {\n  \"use strict\";\n  var dctZigZag = new Int32Array([\n     0,\n     1,  8,\n    16,  9,  2,\n     3, 10, 17, 24,\n    32, 25, 18, 11, 4,\n     5, 12, 19, 26, 33, 40,\n    48, 41, 34, 27, 20, 13,  6,\n     7, 14, 21, 28, 35, 42, 49, 56,\n    57, 50, 43, 36, 29, 22, 15,\n    23, 30, 37, 44, 51, 58,\n    59, 52, 45, 38, 31,\n    39, 46, 53, 60,\n    61, 54, 47,\n    55, 62,\n    63\n  ]);\n\n  var dctCos1  =  4017   // cos(pi/16)\n  var dctSin1  =   799   // sin(pi/16)\n  var dctCos3  =  3406   // cos(3*pi/16)\n  var dctSin3  =  2276   // sin(3*pi/16)\n  var dctCos6  =  1567   // cos(6*pi/16)\n  var dctSin6  =  3784   // sin(6*pi/16)\n  var dctSqrt2 =  5793   // sqrt(2)\n  var dctSqrt1d2 = 2896  // sqrt(2) / 2\n\n  function constructor() {\n  }\n\n  function buildHuffmanTable(codeLengths, values) {\n    var k = 0, code = [], i, j, length = 16;\n    while (length > 0 && !codeLengths[length - 1])\n      length--;\n    code.push({children: [], index: 0});\n    var p = code[0], q;\n    for (i = 0; i < length; i++) {\n      for (j = 0; j < codeLengths[i]; j++) {\n        p = code.pop();\n        p.children[p.index] = values[k];\n        while (p.index > 0) {\n          if (code.length === 0)\n            throw new Error('Could not recreate Huffman Table');\n          p = code.pop();\n        }\n        p.index++;\n        code.push(p);\n        while (code.length <= i) {\n          code.push(q = {children: [], index: 0});\n          p.children[p.index] = q.children;\n          p = q;\n        }\n        k++;\n      }\n      if (i + 1 < length) {\n        // p here points to last code\n        code.push(q = {children: [], index: 0});\n        p.children[p.index] = q.children;\n        p = q;\n      }\n    }\n    return code[0].children;\n  }\n\n  function decodeScan(data, offset,\n                      frame, components, resetInterval,\n                      spectralStart, spectralEnd,\n                      successivePrev, successive) {\n    var precision = frame.precision;\n    var samplesPerLine = frame.samplesPerLine;\n    var scanLines = frame.scanLines;\n    var mcusPerLine = frame.mcusPerLine;\n    var progressive = frame.progressive;\n    var maxH = frame.maxH, maxV = frame.maxV;\n\n    var startOffset = offset, bitsData = 0, bitsCount = 0;\n    function readBit() {\n      if (bitsCount > 0) {\n        bitsCount--;\n        return (bitsData >> bitsCount) & 1;\n      }\n      bitsData = data[offset++];\n      if (bitsData == 0xFF) {\n        var nextByte = data[offset++];\n        if (nextByte) {\n          throw new Error(\"unexpected marker: \" + ((bitsData << 8) | nextByte).toString(16));\n        }\n        // unstuff 0\n      }\n      bitsCount = 7;\n      return bitsData >>> 7;\n    }\n    function decodeHuffman(tree) {\n      var node = tree, bit;\n      while ((bit = readBit()) !== null) {\n        node = node[bit];\n        if (typeof node === 'number')\n          return node;\n        if (typeof node !== 'object')\n          throw new Error(\"invalid huffman sequence\");\n      }\n      return null;\n    }\n    function receive(length) {\n      var n = 0;\n      while (length > 0) {\n        var bit = readBit();\n        if (bit === null) return;\n        n = (n << 1) | bit;\n        length--;\n      }\n      return n;\n    }\n    function receiveAndExtend(length) {\n      var n = receive(length);\n      if (n >= 1 << (length - 1))\n        return n;\n      return n + (-1 << length) + 1;\n    }\n    function decodeBaseline(component, zz) {\n      var t = decodeHuffman(component.huffmanTableDC);\n      var diff = t === 0 ? 0 : receiveAndExtend(t);\n      zz[0]= (component.pred += diff);\n      var k = 1;\n      while (k < 64) {\n        var rs = decodeHuffman(component.huffmanTableAC);\n        var s = rs & 15, r = rs >> 4;\n        if (s === 0) {\n          if (r < 15)\n            break;\n          k += 16;\n          continue;\n        }\n        k += r;\n        var z = dctZigZag[k];\n        zz[z] = receiveAndExtend(s);\n        k++;\n      }\n    }\n    function decodeDCFirst(component, zz) {\n      var t = decodeHuffman(component.huffmanTableDC);\n      var diff = t === 0 ? 0 : (receiveAndExtend(t) << successive);\n      zz[0] = (component.pred += diff);\n    }\n    function decodeDCSuccessive(component, zz) {\n      zz[0] |= readBit() << successive;\n    }\n    var eobrun = 0;\n    function decodeACFirst(component, zz) {\n      if (eobrun > 0) {\n        eobrun--;\n        return;\n      }\n      var k = spectralStart, e = spectralEnd;\n      while (k <= e) {\n        var rs = decodeHuffman(component.huffmanTableAC);\n        var s = rs & 15, r = rs >> 4;\n        if (s === 0) {\n          if (r < 15) {\n            eobrun = receive(r) + (1 << r) - 1;\n            break;\n          }\n          k += 16;\n          continue;\n        }\n        k += r;\n        var z = dctZigZag[k];\n        zz[z] = receiveAndExtend(s) * (1 << successive);\n        k++;\n      }\n    }\n    var successiveACState = 0, successiveACNextValue;\n    function decodeACSuccessive(component, zz) {\n      var k = spectralStart, e = spectralEnd, r = 0;\n      while (k <= e) {\n        var z = dctZigZag[k];\n        var direction = zz[z] < 0 ? -1 : 1;\n        switch (successiveACState) {\n        case 0: // initial state\n          var rs = decodeHuffman(component.huffmanTableAC);\n          var s = rs & 15, r = rs >> 4;\n          if (s === 0) {\n            if (r < 15) {\n              eobrun = receive(r) + (1 << r);\n              successiveACState = 4;\n            } else {\n              r = 16;\n              successiveACState = 1;\n            }\n          } else {\n            if (s !== 1)\n              throw new Error(\"invalid ACn encoding\");\n            successiveACNextValue = receiveAndExtend(s);\n            successiveACState = r ? 2 : 3;\n          }\n          continue;\n        case 1: // skipping r zero items\n        case 2:\n          if (zz[z])\n            zz[z] += (readBit() << successive) * direction;\n          else {\n            r--;\n            if (r === 0)\n              successiveACState = successiveACState == 2 ? 3 : 0;\n          }\n          break;\n        case 3: // set value for a zero item\n          if (zz[z])\n            zz[z] += (readBit() << successive) * direction;\n          else {\n            zz[z] = successiveACNextValue << successive;\n            successiveACState = 0;\n          }\n          break;\n        case 4: // eob\n          if (zz[z])\n            zz[z] += (readBit() << successive) * direction;\n          break;\n        }\n        k++;\n      }\n      if (successiveACState === 4) {\n        eobrun--;\n        if (eobrun === 0)\n          successiveACState = 0;\n      }\n    }\n    function decodeMcu(component, decode, mcu, row, col) {\n      var mcuRow = (mcu / mcusPerLine) | 0;\n      var mcuCol = mcu % mcusPerLine;\n      var blockRow = mcuRow * component.v + row;\n      var blockCol = mcuCol * component.h + col;\n      decode(component, component.blocks[blockRow][blockCol]);\n    }\n    function decodeBlock(component, decode, mcu) {\n      var blockRow = (mcu / component.blocksPerLine) | 0;\n      var blockCol = mcu % component.blocksPerLine;\n      decode(component, component.blocks[blockRow][blockCol]);\n    }\n\n    var componentsLength = components.length;\n    var component, i, j, k, n;\n    var decodeFn;\n    if (progressive) {\n      if (spectralStart === 0)\n        decodeFn = successivePrev === 0 ? decodeDCFirst : decodeDCSuccessive;\n      else\n        decodeFn = successivePrev === 0 ? decodeACFirst : decodeACSuccessive;\n    } else {\n      decodeFn = decodeBaseline;\n    }\n\n    var mcu = 0, marker;\n    var mcuExpected;\n    if (componentsLength == 1) {\n      mcuExpected = components[0].blocksPerLine * components[0].blocksPerColumn;\n    } else {\n      mcuExpected = mcusPerLine * frame.mcusPerColumn;\n    }\n    if (!resetInterval) resetInterval = mcuExpected;\n\n    var h, v;\n    while (mcu < mcuExpected) {\n      // reset interval stuff\n      for (i = 0; i < componentsLength; i++)\n        components[i].pred = 0;\n      eobrun = 0;\n\n      if (componentsLength == 1) {\n        component = components[0];\n        for (n = 0; n < resetInterval; n++) {\n          decodeBlock(component, decodeFn, mcu);\n          mcu++;\n        }\n      } else {\n        for (n = 0; n < resetInterval; n++) {\n          for (i = 0; i < componentsLength; i++) {\n            component = components[i];\n            h = component.h;\n            v = component.v;\n            for (j = 0; j < v; j++) {\n              for (k = 0; k < h; k++) {\n                decodeMcu(component, decodeFn, mcu, j, k);\n              }\n            }\n          }\n          mcu++;\n\n          // If we've reached our expected MCU's, stop decoding\n          if (mcu === mcuExpected) break;\n        }\n      }\n\n      // find marker\n      bitsCount = 0;\n      marker = (data[offset] << 8) | data[offset + 1];\n      if (marker < 0xFF00) {\n        throw new Error(\"marker was not found\");\n      }\n\n      if (marker >= 0xFFD0 && marker <= 0xFFD7) { // RSTx\n        offset += 2;\n      }\n      else\n        break;\n    }\n\n    return offset - startOffset;\n  }\n\n  function buildComponentData(frame, component) {\n    var lines = [];\n    var blocksPerLine = component.blocksPerLine;\n    var blocksPerColumn = component.blocksPerColumn;\n    var samplesPerLine = blocksPerLine << 3;\n    var R = new Int32Array(64), r = new Uint8Array(64);\n\n    // A port of poppler's IDCT method which in turn is taken from:\n    //   Christoph Loeffler, Adriaan Ligtenberg, George S. Moschytz,\n    //   \"Practical Fast 1-D DCT Algorithms with 11 Multiplications\",\n    //   IEEE Intl. Conf. on Acoustics, Speech & Signal Processing, 1989,\n    //   988-991.\n    function quantizeAndInverse(zz, dataOut, dataIn) {\n      var qt = component.quantizationTable;\n      var v0, v1, v2, v3, v4, v5, v6, v7, t;\n      var p = dataIn;\n      var i;\n\n      // dequant\n      for (i = 0; i < 64; i++)\n        p[i] = zz[i] * qt[i];\n\n      // inverse DCT on rows\n      for (i = 0; i < 8; ++i) {\n        var row = 8 * i;\n\n        // check for all-zero AC coefficients\n        if (p[1 + row] == 0 && p[2 + row] == 0 && p[3 + row] == 0 &&\n            p[4 + row] == 0 && p[5 + row] == 0 && p[6 + row] == 0 &&\n            p[7 + row] == 0) {\n          t = (dctSqrt2 * p[0 + row] + 512) >> 10;\n          p[0 + row] = t;\n          p[1 + row] = t;\n          p[2 + row] = t;\n          p[3 + row] = t;\n          p[4 + row] = t;\n          p[5 + row] = t;\n          p[6 + row] = t;\n          p[7 + row] = t;\n          continue;\n        }\n\n        // stage 4\n        v0 = (dctSqrt2 * p[0 + row] + 128) >> 8;\n        v1 = (dctSqrt2 * p[4 + row] + 128) >> 8;\n        v2 = p[2 + row];\n        v3 = p[6 + row];\n        v4 = (dctSqrt1d2 * (p[1 + row] - p[7 + row]) + 128) >> 8;\n        v7 = (dctSqrt1d2 * (p[1 + row] + p[7 + row]) + 128) >> 8;\n        v5 = p[3 + row] << 4;\n        v6 = p[5 + row] << 4;\n\n        // stage 3\n        t = (v0 - v1+ 1) >> 1;\n        v0 = (v0 + v1 + 1) >> 1;\n        v1 = t;\n        t = (v2 * dctSin6 + v3 * dctCos6 + 128) >> 8;\n        v2 = (v2 * dctCos6 - v3 * dctSin6 + 128) >> 8;\n        v3 = t;\n        t = (v4 - v6 + 1) >> 1;\n        v4 = (v4 + v6 + 1) >> 1;\n        v6 = t;\n        t = (v7 + v5 + 1) >> 1;\n        v5 = (v7 - v5 + 1) >> 1;\n        v7 = t;\n\n        // stage 2\n        t = (v0 - v3 + 1) >> 1;\n        v0 = (v0 + v3 + 1) >> 1;\n        v3 = t;\n        t = (v1 - v2 + 1) >> 1;\n        v1 = (v1 + v2 + 1) >> 1;\n        v2 = t;\n        t = (v4 * dctSin3 + v7 * dctCos3 + 2048) >> 12;\n        v4 = (v4 * dctCos3 - v7 * dctSin3 + 2048) >> 12;\n        v7 = t;\n        t = (v5 * dctSin1 + v6 * dctCos1 + 2048) >> 12;\n        v5 = (v5 * dctCos1 - v6 * dctSin1 + 2048) >> 12;\n        v6 = t;\n\n        // stage 1\n        p[0 + row] = v0 + v7;\n        p[7 + row] = v0 - v7;\n        p[1 + row] = v1 + v6;\n        p[6 + row] = v1 - v6;\n        p[2 + row] = v2 + v5;\n        p[5 + row] = v2 - v5;\n        p[3 + row] = v3 + v4;\n        p[4 + row] = v3 - v4;\n      }\n\n      // inverse DCT on columns\n      for (i = 0; i < 8; ++i) {\n        var col = i;\n\n        // check for all-zero AC coefficients\n        if (p[1*8 + col] == 0 && p[2*8 + col] == 0 && p[3*8 + col] == 0 &&\n            p[4*8 + col] == 0 && p[5*8 + col] == 0 && p[6*8 + col] == 0 &&\n            p[7*8 + col] == 0) {\n          t = (dctSqrt2 * dataIn[i+0] + 8192) >> 14;\n          p[0*8 + col] = t;\n          p[1*8 + col] = t;\n          p[2*8 + col] = t;\n          p[3*8 + col] = t;\n          p[4*8 + col] = t;\n          p[5*8 + col] = t;\n          p[6*8 + col] = t;\n          p[7*8 + col] = t;\n          continue;\n        }\n\n        // stage 4\n        v0 = (dctSqrt2 * p[0*8 + col] + 2048) >> 12;\n        v1 = (dctSqrt2 * p[4*8 + col] + 2048) >> 12;\n        v2 = p[2*8 + col];\n        v3 = p[6*8 + col];\n        v4 = (dctSqrt1d2 * (p[1*8 + col] - p[7*8 + col]) + 2048) >> 12;\n        v7 = (dctSqrt1d2 * (p[1*8 + col] + p[7*8 + col]) + 2048) >> 12;\n        v5 = p[3*8 + col];\n        v6 = p[5*8 + col];\n\n        // stage 3\n        t = (v0 - v1 + 1) >> 1;\n        v0 = (v0 + v1 + 1) >> 1;\n        v1 = t;\n        t = (v2 * dctSin6 + v3 * dctCos6 + 2048) >> 12;\n        v2 = (v2 * dctCos6 - v3 * dctSin6 + 2048) >> 12;\n        v3 = t;\n        t = (v4 - v6 + 1) >> 1;\n        v4 = (v4 + v6 + 1) >> 1;\n        v6 = t;\n        t = (v7 + v5 + 1) >> 1;\n        v5 = (v7 - v5 + 1) >> 1;\n        v7 = t;\n\n        // stage 2\n        t = (v0 - v3 + 1) >> 1;\n        v0 = (v0 + v3 + 1) >> 1;\n        v3 = t;\n        t = (v1 - v2 + 1) >> 1;\n        v1 = (v1 + v2 + 1) >> 1;\n        v2 = t;\n        t = (v4 * dctSin3 + v7 * dctCos3 + 2048) >> 12;\n        v4 = (v4 * dctCos3 - v7 * dctSin3 + 2048) >> 12;\n        v7 = t;\n        t = (v5 * dctSin1 + v6 * dctCos1 + 2048) >> 12;\n        v5 = (v5 * dctCos1 - v6 * dctSin1 + 2048) >> 12;\n        v6 = t;\n\n        // stage 1\n        p[0*8 + col] = v0 + v7;\n        p[7*8 + col] = v0 - v7;\n        p[1*8 + col] = v1 + v6;\n        p[6*8 + col] = v1 - v6;\n        p[2*8 + col] = v2 + v5;\n        p[5*8 + col] = v2 - v5;\n        p[3*8 + col] = v3 + v4;\n        p[4*8 + col] = v3 - v4;\n      }\n\n      // convert to 8-bit integers\n      for (i = 0; i < 64; ++i) {\n        var sample = 128 + ((p[i] + 8) >> 4);\n        dataOut[i] = sample < 0 ? 0 : sample > 0xFF ? 0xFF : sample;\n      }\n    }\n\n    var i, j;\n    for (var blockRow = 0; blockRow < blocksPerColumn; blockRow++) {\n      var scanLine = blockRow << 3;\n      for (i = 0; i < 8; i++)\n        lines.push(new Uint8Array(samplesPerLine));\n      for (var blockCol = 0; blockCol < blocksPerLine; blockCol++) {\n        quantizeAndInverse(component.blocks[blockRow][blockCol], r, R);\n\n        var offset = 0, sample = blockCol << 3;\n        for (j = 0; j < 8; j++) {\n          var line = lines[scanLine + j];\n          for (i = 0; i < 8; i++)\n            line[sample + i] = r[offset++];\n        }\n      }\n    }\n    return lines;\n  }\n\n  function clampTo8bit(a) {\n    return a < 0 ? 0 : a > 255 ? 255 : a;\n  }\n\n  constructor.prototype = {\n    load: function load(path) {\n      var xhr = new XMLHttpRequest();\n      xhr.open(\"GET\", path, true);\n      xhr.responseType = \"arraybuffer\";\n      xhr.onload = (function() {\n        // TODO catch parse error\n        var data = new Uint8Array(xhr.response || xhr.mozResponseArrayBuffer);\n        this.parse(data);\n        if (this.onload)\n          this.onload();\n      }).bind(this);\n      xhr.send(null);\n    },\n    parse: function parse(data) {\n      var offset = 0, length = data.length;\n      function readUint16() {\n        var value = (data[offset] << 8) | data[offset + 1];\n        offset += 2;\n        return value;\n      }\n      function readDataBlock() {\n        var length = readUint16();\n        var array = data.subarray(offset, offset + length - 2);\n        offset += array.length;\n        return array;\n      }\n      function prepareComponents(frame) {\n        var maxH = 0, maxV = 0;\n        var component, componentId;\n        for (componentId in frame.components) {\n          if (frame.components.hasOwnProperty(componentId)) {\n            component = frame.components[componentId];\n            if (maxH < component.h) maxH = component.h;\n            if (maxV < component.v) maxV = component.v;\n          }\n        }\n        var mcusPerLine = Math.ceil(frame.samplesPerLine / 8 / maxH);\n        var mcusPerColumn = Math.ceil(frame.scanLines / 8 / maxV);\n        for (componentId in frame.components) {\n          if (frame.components.hasOwnProperty(componentId)) {\n            component = frame.components[componentId];\n            var blocksPerLine = Math.ceil(Math.ceil(frame.samplesPerLine / 8) * component.h / maxH);\n            var blocksPerColumn = Math.ceil(Math.ceil(frame.scanLines  / 8) * component.v / maxV);\n            var blocksPerLineForMcu = mcusPerLine * component.h;\n            var blocksPerColumnForMcu = mcusPerColumn * component.v;\n            var blocks = [];\n            for (var i = 0; i < blocksPerColumnForMcu; i++) {\n              var row = [];\n              for (var j = 0; j < blocksPerLineForMcu; j++)\n                row.push(new Int32Array(64));\n              blocks.push(row);\n            }\n            component.blocksPerLine = blocksPerLine;\n            component.blocksPerColumn = blocksPerColumn;\n            component.blocks = blocks;\n          }\n        }\n        frame.maxH = maxH;\n        frame.maxV = maxV;\n        frame.mcusPerLine = mcusPerLine;\n        frame.mcusPerColumn = mcusPerColumn;\n      }\n      var jfif = null;\n      var adobe = null;\n      var pixels = null;\n      var frame, resetInterval;\n      var quantizationTables = [], frames = [];\n      var huffmanTablesAC = [], huffmanTablesDC = [];\n      var fileMarker = readUint16();\n      if (fileMarker != 0xFFD8) { // SOI (Start of Image)\n        throw new Error(\"SOI not found\");\n      }\n\n      fileMarker = readUint16();\n      while (fileMarker != 0xFFD9) { // EOI (End of image)\n        var i, j, l;\n        switch(fileMarker) {\n          case 0xFF00: break;\n          case 0xFFE0: // APP0 (Application Specific)\n          case 0xFFE1: // APP1\n          case 0xFFE2: // APP2\n          case 0xFFE3: // APP3\n          case 0xFFE4: // APP4\n          case 0xFFE5: // APP5\n          case 0xFFE6: // APP6\n          case 0xFFE7: // APP7\n          case 0xFFE8: // APP8\n          case 0xFFE9: // APP9\n          case 0xFFEA: // APP10\n          case 0xFFEB: // APP11\n          case 0xFFEC: // APP12\n          case 0xFFED: // APP13\n          case 0xFFEE: // APP14\n          case 0xFFEF: // APP15\n          case 0xFFFE: // COM (Comment)\n            var appData = readDataBlock();\n\n            if (fileMarker === 0xFFE0) {\n              if (appData[0] === 0x4A && appData[1] === 0x46 && appData[2] === 0x49 &&\n                appData[3] === 0x46 && appData[4] === 0) { // 'JFIF\\x00'\n                jfif = {\n                  version: { major: appData[5], minor: appData[6] },\n                  densityUnits: appData[7],\n                  xDensity: (appData[8] << 8) | appData[9],\n                  yDensity: (appData[10] << 8) | appData[11],\n                  thumbWidth: appData[12],\n                  thumbHeight: appData[13],\n                  thumbData: appData.subarray(14, 14 + 3 * appData[12] * appData[13])\n                };\n              }\n            }\n            // TODO APP1 - Exif\n            if (fileMarker === 0xFFEE) {\n              if (appData[0] === 0x41 && appData[1] === 0x64 && appData[2] === 0x6F &&\n                appData[3] === 0x62 && appData[4] === 0x65 && appData[5] === 0) { // 'Adobe\\x00'\n                adobe = {\n                  version: appData[6],\n                  flags0: (appData[7] << 8) | appData[8],\n                  flags1: (appData[9] << 8) | appData[10],\n                  transformCode: appData[11]\n                };\n              }\n            }\n            break;\n\n          case 0xFFDB: // DQT (Define Quantization Tables)\n            var quantizationTablesLength = readUint16();\n            var quantizationTablesEnd = quantizationTablesLength + offset - 2;\n            while (offset < quantizationTablesEnd) {\n              var quantizationTableSpec = data[offset++];\n              var tableData = new Int32Array(64);\n              if ((quantizationTableSpec >> 4) === 0) { // 8 bit values\n                for (j = 0; j < 64; j++) {\n                  var z = dctZigZag[j];\n                  tableData[z] = data[offset++];\n                }\n              } else if ((quantizationTableSpec >> 4) === 1) { //16 bit\n                for (j = 0; j < 64; j++) {\n                  var z = dctZigZag[j];\n                  tableData[z] = readUint16();\n                }\n              } else\n                throw new Error(\"DQT: invalid table spec\");\n              quantizationTables[quantizationTableSpec & 15] = tableData;\n            }\n            break;\n\n          case 0xFFC0: // SOF0 (Start of Frame, Baseline DCT)\n          case 0xFFC1: // SOF1 (Start of Frame, Extended DCT)\n          case 0xFFC2: // SOF2 (Start of Frame, Progressive DCT)\n            readUint16(); // skip data length\n            frame = {};\n            frame.extended = (fileMarker === 0xFFC1);\n            frame.progressive = (fileMarker === 0xFFC2);\n            frame.precision = data[offset++];\n            frame.scanLines = readUint16();\n            frame.samplesPerLine = readUint16();\n            frame.components = {};\n            frame.componentsOrder = [];\n            var componentsCount = data[offset++], componentId;\n            var maxH = 0, maxV = 0;\n            for (i = 0; i < componentsCount; i++) {\n              componentId = data[offset];\n              var h = data[offset + 1] >> 4;\n              var v = data[offset + 1] & 15;\n              var qId = data[offset + 2];\n              frame.componentsOrder.push(componentId);\n              frame.components[componentId] = {\n                h: h,\n                v: v,\n                quantizationIdx: qId\n              };\n              offset += 3;\n            }\n            prepareComponents(frame);\n            frames.push(frame);\n            break;\n\n          case 0xFFC4: // DHT (Define Huffman Tables)\n            var huffmanLength = readUint16();\n            for (i = 2; i < huffmanLength;) {\n              var huffmanTableSpec = data[offset++];\n              var codeLengths = new Uint8Array(16);\n              var codeLengthSum = 0;\n              for (j = 0; j < 16; j++, offset++)\n                codeLengthSum += (codeLengths[j] = data[offset]);\n              var huffmanValues = new Uint8Array(codeLengthSum);\n              for (j = 0; j < codeLengthSum; j++, offset++)\n                huffmanValues[j] = data[offset];\n              i += 17 + codeLengthSum;\n\n              ((huffmanTableSpec >> 4) === 0 ?\n                huffmanTablesDC : huffmanTablesAC)[huffmanTableSpec & 15] =\n                buildHuffmanTable(codeLengths, huffmanValues);\n            }\n            break;\n\n          case 0xFFDD: // DRI (Define Restart Interval)\n            readUint16(); // skip data length\n            resetInterval = readUint16();\n            break;\n\n          case 0xFFDA: // SOS (Start of Scan)\n            var scanLength = readUint16();\n            var selectorsCount = data[offset++];\n            var components = [], component;\n            for (i = 0; i < selectorsCount; i++) {\n              component = frame.components[data[offset++]];\n              var tableSpec = data[offset++];\n              component.huffmanTableDC = huffmanTablesDC[tableSpec >> 4];\n              component.huffmanTableAC = huffmanTablesAC[tableSpec & 15];\n              components.push(component);\n            }\n            var spectralStart = data[offset++];\n            var spectralEnd = data[offset++];\n            var successiveApproximation = data[offset++];\n            var processed = decodeScan(data, offset,\n              frame, components, resetInterval,\n              spectralStart, spectralEnd,\n              successiveApproximation >> 4, successiveApproximation & 15);\n            offset += processed;\n            break;\n\n          case 0xFFFF: // Fill bytes\n            if (data[offset] !== 0xFF) { // Avoid skipping a valid marker.\n              offset--;\n            }\n            break;\n\n          default:\n            if (data[offset - 3] == 0xFF &&\n                data[offset - 2] >= 0xC0 && data[offset - 2] <= 0xFE) {\n              // could be incorrect encoding -- last 0xFF byte of the previous\n              // block was eaten by the encoder\n              offset -= 3;\n              break;\n            }\n            throw new Error(\"unknown JPEG marker \" + fileMarker.toString(16));\n        }\n        fileMarker = readUint16();\n      }\n      if (frames.length != 1)\n        throw new Error(\"only single frame JPEGs supported\");\n\n      // set each frame's components quantization table\n      for (var i = 0; i < frames.length; i++) {\n        var cp = frames[i].components;\n        for (var j in cp) {\n          cp[j].quantizationTable = quantizationTables[cp[j].quantizationIdx];\n          delete cp[j].quantizationIdx;\n        }\n      }\n\n      this.width = frame.samplesPerLine;\n      this.height = frame.scanLines;\n      this.jfif = jfif;\n      this.adobe = adobe;\n      this.components = [];\n      for (var i = 0; i < frame.componentsOrder.length; i++) {\n        var component = frame.components[frame.componentsOrder[i]];\n        this.components.push({\n          lines: buildComponentData(frame, component),\n          scaleX: component.h / frame.maxH,\n          scaleY: component.v / frame.maxV\n        });\n      }\n    },\n    getData: function getData(width, height) {\n      var scaleX = this.width / width, scaleY = this.height / height;\n\n      var component1, component2, component3, component4;\n      var component1Line, component2Line, component3Line, component4Line;\n      var x, y;\n      var offset = 0;\n      var Y, Cb, Cr, K, C, M, Ye, R, G, B;\n      var colorTransform;\n      var dataLength = width * height * this.components.length;\n      var data = new Uint8Array(dataLength);\n      switch (this.components.length) {\n        case 1:\n          component1 = this.components[0];\n          for (y = 0; y < height; y++) {\n            component1Line = component1.lines[0 | (y * component1.scaleY * scaleY)];\n            for (x = 0; x < width; x++) {\n              Y = component1Line[0 | (x * component1.scaleX * scaleX)];\n\n              data[offset++] = Y;\n            }\n          }\n          break;\n        case 2:\n          // PDF might compress two component data in custom colorspace\n          component1 = this.components[0];\n          component2 = this.components[1];\n          for (y = 0; y < height; y++) {\n            component1Line = component1.lines[0 | (y * component1.scaleY * scaleY)];\n            component2Line = component2.lines[0 | (y * component2.scaleY * scaleY)];\n            for (x = 0; x < width; x++) {\n              Y = component1Line[0 | (x * component1.scaleX * scaleX)];\n              data[offset++] = Y;\n              Y = component2Line[0 | (x * component2.scaleX * scaleX)];\n              data[offset++] = Y;\n            }\n          }\n          break;\n        case 3:\n          // The default transform for three components is true\n          colorTransform = true;\n          // The adobe transform marker overrides any previous setting\n          if (this.adobe && this.adobe.transformCode)\n            colorTransform = true;\n          else if (typeof this.colorTransform !== 'undefined')\n            colorTransform = !!this.colorTransform;\n\n          component1 = this.components[0];\n          component2 = this.components[1];\n          component3 = this.components[2];\n          for (y = 0; y < height; y++) {\n            component1Line = component1.lines[0 | (y * component1.scaleY * scaleY)];\n            component2Line = component2.lines[0 | (y * component2.scaleY * scaleY)];\n            component3Line = component3.lines[0 | (y * component3.scaleY * scaleY)];\n            for (x = 0; x < width; x++) {\n              if (!colorTransform) {\n                R = component1Line[0 | (x * component1.scaleX * scaleX)];\n                G = component2Line[0 | (x * component2.scaleX * scaleX)];\n                B = component3Line[0 | (x * component3.scaleX * scaleX)];\n              } else {\n                Y = component1Line[0 | (x * component1.scaleX * scaleX)];\n                Cb = component2Line[0 | (x * component2.scaleX * scaleX)];\n                Cr = component3Line[0 | (x * component3.scaleX * scaleX)];\n\n                R = clampTo8bit(Y + 1.402 * (Cr - 128));\n                G = clampTo8bit(Y - 0.3441363 * (Cb - 128) - 0.71413636 * (Cr - 128));\n                B = clampTo8bit(Y + 1.772 * (Cb - 128));\n              }\n\n              data[offset++] = R;\n              data[offset++] = G;\n              data[offset++] = B;\n            }\n          }\n          break;\n        case 4:\n          if (!this.adobe)\n            throw new Error('Unsupported color mode (4 components)');\n          // The default transform for four components is false\n          colorTransform = false;\n          // The adobe transform marker overrides any previous setting\n          if (this.adobe && this.adobe.transformCode)\n            colorTransform = true;\n          else if (typeof this.colorTransform !== 'undefined')\n            colorTransform = !!this.colorTransform;\n\n          component1 = this.components[0];\n          component2 = this.components[1];\n          component3 = this.components[2];\n          component4 = this.components[3];\n          for (y = 0; y < height; y++) {\n            component1Line = component1.lines[0 | (y * component1.scaleY * scaleY)];\n            component2Line = component2.lines[0 | (y * component2.scaleY * scaleY)];\n            component3Line = component3.lines[0 | (y * component3.scaleY * scaleY)];\n            component4Line = component4.lines[0 | (y * component4.scaleY * scaleY)];\n            for (x = 0; x < width; x++) {\n              if (!colorTransform) {\n                C = component1Line[0 | (x * component1.scaleX * scaleX)];\n                M = component2Line[0 | (x * component2.scaleX * scaleX)];\n                Ye = component3Line[0 | (x * component3.scaleX * scaleX)];\n                K = component4Line[0 | (x * component4.scaleX * scaleX)];\n              } else {\n                Y = component1Line[0 | (x * component1.scaleX * scaleX)];\n                Cb = component2Line[0 | (x * component2.scaleX * scaleX)];\n                Cr = component3Line[0 | (x * component3.scaleX * scaleX)];\n                K = component4Line[0 | (x * component4.scaleX * scaleX)];\n\n                C = 255 - clampTo8bit(Y + 1.402 * (Cr - 128));\n                M = 255 - clampTo8bit(Y - 0.3441363 * (Cb - 128) - 0.71413636 * (Cr - 128));\n                Ye = 255 - clampTo8bit(Y + 1.772 * (Cb - 128));\n              }\n              data[offset++] = 255-C;\n              data[offset++] = 255-M;\n              data[offset++] = 255-Ye;\n              data[offset++] = 255-K;\n            }\n          }\n          break;\n        default:\n          throw new Error('Unsupported color mode');\n      }\n      return data;\n    },\n    copyToImageData: function copyToImageData(imageData, formatAsRGBA) {\n      var width = imageData.width, height = imageData.height;\n      var imageDataArray = imageData.data;\n      var data = this.getData(width, height);\n      var i = 0, j = 0, x, y;\n      var Y, K, C, M, R, G, B;\n      switch (this.components.length) {\n        case 1:\n          for (y = 0; y < height; y++) {\n            for (x = 0; x < width; x++) {\n              Y = data[i++];\n\n              imageDataArray[j++] = Y;\n              imageDataArray[j++] = Y;\n              imageDataArray[j++] = Y;\n              if (formatAsRGBA) {\n                imageDataArray[j++] = 255;\n              }\n            }\n          }\n          break;\n        case 3:\n          for (y = 0; y < height; y++) {\n            for (x = 0; x < width; x++) {\n              R = data[i++];\n              G = data[i++];\n              B = data[i++];\n\n              imageDataArray[j++] = R;\n              imageDataArray[j++] = G;\n              imageDataArray[j++] = B;\n              if (formatAsRGBA) {\n                imageDataArray[j++] = 255;\n              }\n            }\n          }\n          break;\n        case 4:\n          for (y = 0; y < height; y++) {\n            for (x = 0; x < width; x++) {\n              C = data[i++];\n              M = data[i++];\n              Y = data[i++];\n              K = data[i++];\n\n              R = 255 - clampTo8bit(C * (1 - K / 255) + K);\n              G = 255 - clampTo8bit(M * (1 - K / 255) + K);\n              B = 255 - clampTo8bit(Y * (1 - K / 255) + K);\n\n              imageDataArray[j++] = R;\n              imageDataArray[j++] = G;\n              imageDataArray[j++] = B;\n              if (formatAsRGBA) {\n                imageDataArray[j++] = 255;\n              }\n            }\n          }\n          break;\n        default:\n          throw new Error('Unsupported color mode');\n      }\n    }\n  };\n\n  return constructor;\n})();\nmodule.exports = decode;\n\nfunction decode(jpegData, opts) {\n  var defaultOpts = {\n    useTArray: false,\n    // \"undefined\" means \"Choose whether to transform colors based on the images color model.\"\n    colorTransform: undefined,\n    formatAsRGBA: true\n  };\n  if (opts) {\n    if (typeof opts === 'object') {\n      opts = {\n        useTArray: (typeof opts.useTArray === 'undefined' ?\n                    defaultOpts.useTArray : opts.useTArray),\n        colorTransform: (typeof opts.colorTransform === 'undefined' ?\n                         defaultOpts.colorTransform : opts.colorTransform),\n        formatAsRGBA: (typeof opts.formatAsRGBA === 'undefined' ?\n                         defaultOpts.formatAsRGBA : opts.formatAsRGBA)\n      };\n    } else {\n      // backwards compatiblity, before 0.3.5, we only had the useTArray param\n      opts = defaultOpts;\n      opts.useTArray = true;\n    }\n  } else {\n    opts = defaultOpts;\n  }\n\n  var arr = new Uint8Array(jpegData);\n  var decoder = new JpegImage();\n  decoder.parse(arr);\n  decoder.colorTransform = opts.colorTransform;\n\n  var channels = (opts.formatAsRGBA) ? 4 : 3;\n  var bytesNeeded = decoder.width * decoder.height * channels;\n  try {\n    var image = {\n      width: decoder.width,\n      height: decoder.height,\n      data: opts.useTArray ?\n        new Uint8Array(bytesNeeded) :\n        new Buffer(bytesNeeded)\n    };\n  } catch (err){\n    if (err instanceof RangeError){\n      throw new Error(\"Could not allocate enough memory for the image. \" +\n                      \"Required: \" + bytesNeeded);\n    } else {\n      throw err;\n    }\n  }\n\n  decoder.copyToImageData(image, opts.formatAsRGBA);\n\n  return image;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}